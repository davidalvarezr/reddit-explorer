import { parseRedGifsPost } from "../../src/media_parsers/red_gifs/parseRedGifsPost"
import { Extension } from "../../src/media_parsers/Extension"
import { Quality } from "../../src/media_parsers/Quality"
import { MediaType } from "../../src/media_parsers/MediaType"

const postContainingRedGifsMedia = {
    approved_at_utc: null,
    subreddit: "doublepenetration",
    selftext: "",
    author_fullname: "t2_9ja1d17h",
    saved: false,
    mod_reason_title: null,
    gilded: 0,
    clicked: false,
    title: "2xDP &gt; 1xDP",
    link_flair_richtext: [],
    subreddit_name_prefixed: "r/doublepenetration",
    hidden: false,
    pwls: 0,
    link_flair_css_class: null,
    downs: 0,
    thumbnail_height: 78,
    top_awarded_type: null,
    hide_score: false,
    name: "t3_u5nssl",
    quarantine: false,
    link_flair_text_color: "dark",
    upvote_ratio: 0.98,
    author_flair_background_color: null,
    subreddit_type: "public",
    ups: 550,
    total_awards_received: 0,
    media_embed: {
        content:
            '&lt;iframe src="https://www.redgifs.com/ifr/elegantunluckyxenoposeidon" frameborder="0" scrolling="no" width="100%" height="100%"\n      allowfullscreen style="position:absolute;"&gt;&lt;/iframe&gt;',
        width: 600,
        scrolling: false,
        height: 338,
    },
    thumbnail_width: 140,
    author_flair_template_id: null,
    is_original_content: false,
    user_reports: [],
    secure_media: {
        type: "redgifs.com",
        oembed: {
            provider_url: "https://www.redgifs.com/",
            version: "1.0",
            title: "Anal Porn GIF",
            type: "video",
            thumbnail_width: 854,
            height: 338,
            width: 600,
            html: '&lt;iframe src="https://www.redgifs.com/ifr/elegantunluckyxenoposeidon" frameborder="0" scrolling="no" width="100%" height="100%"\n      allowfullscreen style="position:absolute;"&gt;&lt;/iframe&gt;',
            author_name: "zmo1918",
            provider_name: "RedGIFs",
            thumbnail_url: "https://thumbs2.redgifs.com/ElegantUnluckyXenoposeidon-mobile.jpg",
            thumbnail_height: 480,
            author_url: "https://www.redgifs.com/users/zmo1918",
        },
    },
    is_reddit_media_domain: false,
    is_meta: false,
    category: null,
    secure_media_embed: {
        content:
            '&lt;iframe src="https://www.redgifs.com/ifr/elegantunluckyxenoposeidon" frameborder="0" scrolling="no" width="100%" height="100%"\n      allowfullscreen style="position:absolute;"&gt;&lt;/iframe&gt;',
        width: 600,
        scrolling: false,
        media_domain_url: "https://www.redditmedia.com/mediaembed/u5nssl",
        height: 338,
    },
    link_flair_text: null,
    can_mod_post: false,
    score: 550,
    approved_by: null,
    is_created_from_ads_ui: false,
    author_premium: false,
    thumbnail: "https://b.thumbs.redditmedia.com/CWaTH7xBmzZQ7bBMsk-KBqbUaOxN7VElF_JiD0uMXLw.jpg",
    edited: false,
    author_flair_css_class: null,
    author_flair_richtext: [],
    gildings: {},
    post_hint: "rich:video",
    content_categories: null,
    is_self: false,
    mod_note: null,
    created: 1650204562.0,
    link_flair_type: "text",
    wls: 0,
    removed_by_category: null,
    banned_by: null,
    author_flair_type: "text",
    domain: "redgifs.com",
    allow_live_comments: false,
    selftext_html: null,
    likes: null,
    suggested_sort: null,
    banned_at_utc: null,
    url_overridden_by_dest: "https://redgifs.com/watch/elegantunluckyxenoposeidon",
    view_count: null,
    archived: false,
    no_follow: false,
    is_crosspostable: false,
    pinned: false,
    over_18: true,
    preview: {
        images: [
            {
                source: {
                    url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?auto=webp&amp;s=63f7f89387dd4a1c98d8a2c9c18d7c8ed77eda3c",
                    width: 854,
                    height: 480,
                },
                resolutions: [
                    {
                        url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=108&amp;crop=smart&amp;auto=webp&amp;s=0d3ecb9a242235526199d8f5377d55cefaa8bd42",
                        width: 108,
                        height: 60,
                    },
                    {
                        url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=216&amp;crop=smart&amp;auto=webp&amp;s=899a7e98071a396e08de05b4a12ef22a9767906a",
                        width: 216,
                        height: 121,
                    },
                    {
                        url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=320&amp;crop=smart&amp;auto=webp&amp;s=bb0a90a6c5c56386f3dcf754c35d4b6440c68928",
                        width: 320,
                        height: 179,
                    },
                    {
                        url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=640&amp;crop=smart&amp;auto=webp&amp;s=38a73ad2d6fb41eae2a3341470f3ae27e34e842c",
                        width: 640,
                        height: 359,
                    },
                ],
                variants: {
                    obfuscated: {
                        source: {
                            url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?blur=40&amp;format=pjpg&amp;auto=webp&amp;s=3c755fdd859032cd20c47db90bd7822202e6c9df",
                            width: 854,
                            height: 480,
                        },
                        resolutions: [
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=108&amp;crop=smart&amp;blur=10&amp;format=pjpg&amp;auto=webp&amp;s=14aa3bb53c69e6d01e223d80068dd748d91871d8",
                                width: 108,
                                height: 60,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=216&amp;crop=smart&amp;blur=21&amp;format=pjpg&amp;auto=webp&amp;s=b7920ee5b0c725ae521faa0884951fb3e61aa408",
                                width: 216,
                                height: 121,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=320&amp;crop=smart&amp;blur=32&amp;format=pjpg&amp;auto=webp&amp;s=51b8e84afbe4dab2b2ace68c62a8cc42e53095f5",
                                width: 320,
                                height: 179,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=640&amp;crop=smart&amp;blur=40&amp;format=pjpg&amp;auto=webp&amp;s=79af67807bd4d11dcc68aeadae1acb3359758145",
                                width: 640,
                                height: 359,
                            },
                        ],
                    },
                    nsfw: {
                        source: {
                            url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?blur=40&amp;format=pjpg&amp;auto=webp&amp;s=3c755fdd859032cd20c47db90bd7822202e6c9df",
                            width: 854,
                            height: 480,
                        },
                        resolutions: [
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=108&amp;crop=smart&amp;blur=10&amp;format=pjpg&amp;auto=webp&amp;s=14aa3bb53c69e6d01e223d80068dd748d91871d8",
                                width: 108,
                                height: 60,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=216&amp;crop=smart&amp;blur=21&amp;format=pjpg&amp;auto=webp&amp;s=b7920ee5b0c725ae521faa0884951fb3e61aa408",
                                width: 216,
                                height: 121,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=320&amp;crop=smart&amp;blur=32&amp;format=pjpg&amp;auto=webp&amp;s=51b8e84afbe4dab2b2ace68c62a8cc42e53095f5",
                                width: 320,
                                height: 179,
                            },
                            {
                                url: "https://external-preview.redd.it/eD6akVwoikNrVygDYQz2qRDm55iqE0P9__mkejZ5vd4.jpg?width=640&amp;crop=smart&amp;blur=40&amp;format=pjpg&amp;auto=webp&amp;s=79af67807bd4d11dcc68aeadae1acb3359758145",
                                width: 640,
                                height: 359,
                            },
                        ],
                    },
                },
                id: "Q1fXdvKPsEhGPbEEJ6Ycf8738eEAR5QcuG02o0VAt_4",
            },
        ],
        reddit_video_preview: {
            bitrate_kbps: 4800,
            fallback_url: "https://v.redd.it/plz35s2wj3u81/DASH_1080.mp4",
            height: 1080,
            width: 1920,
            scrubber_media_url: "https://v.redd.it/plz35s2wj3u81/DASH_96.mp4",
            dash_url: "https://v.redd.it/plz35s2wj3u81/DASHPlaylist.mpd",
            duration: 60,
            hls_url: "https://v.redd.it/plz35s2wj3u81/HLSPlaylist.m3u8",
            is_gif: true,
            transcoding_status: "completed",
        },
        enabled: false,
    },
    all_awardings: [],
    awarders: [],
    media_only: false,
    can_gild: false,
    spoiler: false,
    locked: false,
    author_flair_text: null,
    treatment_tags: [],
    visited: false,
    removed_by: null,
    num_reports: null,
    distinguished: null,
    subreddit_id: "t5_2slyo",
    author_is_blocked: false,
    mod_reason_by: null,
    removal_reason: null,
    link_flair_background_color: "",
    id: "u5nssl",
    is_robot_indexable: true,
    report_reasons: null,
    author: "Finlandish-ish",
    discussion_type: null,
    num_comments: 4,
    send_replies: false,
    whitelist_status: "no_ads",
    contest_mode: false,
    mod_reports: [],
    author_patreon_flair: false,
    author_flair_text_color: null,
    permalink: "/r/doublepenetration/comments/u5nssl/2xdp_1xdp/",
    parent_whitelist_status: "no_ads",
    stickied: false,
    url: "https://redgifs.com/watch/elegantunluckyxenoposeidon",
    subreddit_subscribers: 271549,
    created_utc: 1650204562.0,
    num_crossposts: 1,
    media: {
        type: "redgifs.com",
        oembed: {
            provider_url: "https://www.redgifs.com/",
            version: "1.0",
            title: "Anal Porn GIF",
            type: "video",
            thumbnail_width: 854,
            height: 338,
            width: 600,
            html: '&lt;iframe src="https://www.redgifs.com/ifr/elegantunluckyxenoposeidon" frameborder="0" scrolling="no" width="100%" height="100%"\n      allowfullscreen style="position:absolute;"&gt;&lt;/iframe&gt;',
            author_name: "zmo1918",
            provider_name: "RedGIFs",
            thumbnail_url: "https://thumbs2.redgifs.com/ElegantUnluckyXenoposeidon-mobile.jpg",
            thumbnail_height: 480,
            author_url: "https://www.redgifs.com/users/zmo1918",
        },
    },
    is_video: false,
}

const parser = parseRedGifsPost(postContainingRedGifsMedia as any)

test("Should get thumbnail", () => {
    const thumbnail = parser.getThumbnail()
    expect(thumbnail).toEqual(postContainingRedGifsMedia.media.oembed.thumbnail_url)
})

test("Should get standard quality media", () => {
    const media = parser.getMedia(Quality.SD)
    expect(media).toEqual(postContainingRedGifsMedia.media.oembed.thumbnail_url.replace(Extension.Jpg, Extension.Mp4))
})

test("Should get high quality media", () => {
    const media = parser.getMedia(Quality.HD)
    expect(media).toEqual(
        postContainingRedGifsMedia.media.oembed.thumbnail_url.replace(`-mobile.${Extension.Jpg}`, Extension.Mp4)
    )
})

test("Default media should be standard quality", () => {
    const media = parser.getMedia()
    expect(media).toEqual(postContainingRedGifsMedia.media.oembed.thumbnail_url.replace(Extension.Jpg, Extension.Mp4))
})

test("Media should be video", () => {
    const media = parser.getMediaType()
    expect(media).toEqual(MediaType.Video)
})
